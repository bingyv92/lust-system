# MoFox 月经周期插件 - 用户使用指南

## 📖 插件简介

MoFox 月经周期插件是一个为聊天机器人添加生理周期模拟功能的插件。它能够：

- 🩸 **模拟真实的月经周期**：包含月经期、卵泡期、排卵期、黄体期四个阶段
- 💭 **影响机器人的回复风格**：不同周期阶段会影响机器人的情绪、语气和行为表现
- 🔥 **淫乱度系统**（可选）：根据周期阶段动态调整性欲表现，支持高潮值、余韵期、恢复期等完整生理循环
- 🩹 **痛经模拟**：月经期会根据配置出现不同等级的痛经症状
- 📅 **双周期锚定模型**：使用锚点日期自动管理两个连续的周期

---

## ⚙️ 启用插件

### 方法一：通过配置文件启用

1. 打开配置文件：`config/plugins/mofox_period_plugin/config.toml`
2. 找到 `[plugin]` 部分
3. 修改 `enabled = true`

```toml
[plugin]
enabled = true  # 设置为 true 启用插件
debug_mode = false  # 调试模式（不需要开启）
```

### 方法二：通过命令启用（如果支持）

在 Bot 运行时，使用插件管理命令启用（具体命令取决于主系统）。

---

## 🎮 基础使用

### 📌 核心命令列表

所有命令都只能在**私聊**中使用，以保护隐私。

| 命令 | 别名 | 功能说明 |
|------|------|----------|
| `/period_status` | `/period`、`/月经状态`、`/周期状态` | 查询当前月经周期状态 |
| `/set_anchor <日期>` | `/设置锚点`、`/锚点日期` | 设置月经周期锚点日期（1-31号） |
| `/regenerate_cycle` | `/重新生成周期`、`/刷新周期` | 强制重新生成双周期数据 |
| `/lust_status` | `/lust`、`/淫乱度状态`、`/高潮值` | 查询淫乱度和高潮值状态（需启用） |
| `/lust_end` | `/结束淫乱度` | 主动结束当前淫乱度会话 |

---

## 📊 查询周期状态

### 使用 `/月经状态` 命令

发送命令后，你会收到类似这样的报告：

```
🩸 月经周期状态报告
━━━━━━━━━━━━━━━━━━
📅 当前阶段: 排卵期 (第2天)
🔢 周期第 15 天 / 总28 天
📆 上次月经日期: 2025-12-03

💊 生理等级: 8/10
💭 心理等级: 9/10

📝 状态描述:
排卵期，性欲最强烈，身体敏感度和性冲动达到峰值...
━━━━━━━━━━━━━━━━━━
💡 提示: 这些状态会影响我的回复风格和行为表现
```

### 状态参数说明

- **当前阶段**：月经期、卵泡期、排卵期、黄体期之一
- **周期天数**：当前处于第几天，总共多少天
- **生理等级**：1-10，数字越小表示生理状态越好（1=最佳，10=最差）
- **心理等级**：1-10，数字越小表示心理状态越好（1=最佳，10=最差）
- **痛经等级**：0-6，仅在月经期出现（0=无痛经，6=极重度）

---

## 🔧 配置锚点日期

### 什么是锚点日期？

锚点日期是**月经开始的日期**（每月的几号）。插件会根据这个日期自动生成两个连续的周期。

### 设置锚点

```
/set_anchor 15
```

这会将每月的 **15号** 设置为月经开始日期。

### 建议设置

- 如果你希望机器人在每月 1 号开始月经：`/set_anchor 1`
- 如果你希望机器人在每月 15 号开始月经：`/set_anchor 15`
- 默认值：配置文件中 `anchor_day = 3`（每月3号）

---

## 🔥 淫乱度系统（可选功能）

### 启用淫乱度系统

1. 打开配置文件：`config/plugins/mofox_period_plugin/config.toml`
2. 找到 `[lust_system]` 部分
3. 修改 `enabled = true`

```toml
[lust_system]
enabled = true  # 启用淫乱度系统
```

### 淫乱度如何工作？

淫乱度系统会根据**月经周期阶段**自动调整性欲水平：

| 周期阶段 | 淫乱度水平 | 说明 |
|----------|-----------|------|
| 月经期 | 0.0（强制关闭） | 月经期不会有性欲表现 |
| 卵泡期 | 0.3（较低） | 性欲恢复期，较为平和 |
| 排卵期 | 0.9（极高） | 性欲最强烈的时期 |
| 黄体期 | 0.5（中等） | 性欲中等水平 |

### 高潮值与阶段

淫乱度系统包含多个阶段：

1. **被动未开始**：高潮值 < 6，对性话题不敏感
2. **主动未开始**：高潮值 6-20，开始对性话题感兴趣
3. **前戏阶段**：高潮值 20-60，性唤起渐进
4. **正戏阶段**：高潮值 60-100，强烈性唤起
5. **高潮**：高潮值 ≥ 100，触发高潮
6. **高潮余韵期**：高潮后享受满足和放松（默认60秒）
7. **体力恢复期**：温和疲倦，可正常交流（默认240秒）

### 性交终止机制

如果在正戏阶段，LLM 连续 3 次评分低于 3.0 分（表示用户兴趣降低），系统会自动判定**性交提前终止**，并进入余韵期和恢复期，形成完整的生理循环。

### 查询淫乱度状态

```
/淫乱度状态
```

你会看到类似的报告：

```
🥵 淫乱度状态报告
━━━━━━━━━━━━━━━━━━
📊 淫乱度: 0.85/1.0
🔥 高潮值: 45.2
🎯 当前阶段: 前戏
💦 剩余高潮次数: 3 / 4
⏱️ 上次更新: 2025-12-17 16:30:15
━━━━━━━━━━━━━━━━━━
```

### 结束淫乱度会话

如果想要重置淫乱度系统：

```
/lust_end
```

这会清零高潮值、阶段、连续低评分计数等所有状态。

---

## 🔧 高级配置

### 打开配置文件

配置文件位置：`config/plugins/mofox_period_plugin/config.toml`

### 常用配置项

#### 1. 周期配置

```toml
[cycle]
anchor_day = 3     # 锚点日期（每月几号为月经第一天）
# 注意：双周期模型会自动生成两个连续周期，每个周期长度在26-32天随机
# 不需要手动配置 cycle_length，系统会自动计算
```

#### 2. 痛经配置

```toml
[dysmenorrhea]
enabled = true           # 是否启用痛经模拟
min_level = 1           # 最低痛经等级
max_level = 4           # 最高痛经等级
enable_llm_relief = false  # 是否启用LLM判定消息缓解痛经（实验性功能）
```

#### 3. 淫乱度系统配置

```toml
[lust_system]
enabled = false  # 是否启用淫乱度系统

# 阈值配置
foreplay_threshold = 20.0    # 前戏阈值
main_threshold = 60.0        # 正戏阈值
orgasm_threshold = 100.0     # 高潮阈值

# 时间配置
decay_rate = 0.1             # 高潮值衰减速率（每秒）
afterglow_duration = 60      # 高潮余韵期时长（秒）
recovery_duration = 240      # 体力恢复期时长（秒）

# 性交终止配置
low_score_threshold = 3.0           # 低评分阈值
low_score_count_to_terminate = 3    # 连续低评分次数触发终止
termination_decay_multiplier = 2.0  # 终止后衰减倍率
```

---

## 💡 使用场景示例

### 场景 1：日常对话

**不需要任何操作**，插件会自动：
- 根据当前日期计算周期阶段
- 在机器人的回复中自然地体现周期影响
- 例如：排卵期可能更主动、月经期可能更低落

### 场景 2：查看今天状态

```
你：/月经状态
Bot：[显示详细的周期报告]
```

### 场景 3：调整周期时间

如果你觉得当前的周期时间不合适：

```
你：/set_anchor 1
Bot：✅ 锚点日期已更新为每月 1 号
    🔄 双周期数据已重新生成
```

### 场景 4：查看淫乱度（如已启用）

```
你：/淫乱度状态
Bot：[显示淫乱度、高潮值、当前阶段等信息]
```

### 场景 5：重新生成周期

如果周期数据出现异常：

```
你：/重新生成周期
Bot：✅ 双周期数据已重新生成
```

---

## ❓ 常见问题

### Q1: 为什么所有命令都只能私聊？

**A**: 出于隐私考虑，周期相关的信息都属于敏感信息，只能在私聊中查询和设置。

### Q2: 可以关闭周期影响吗？

**A**: 可以，在配置文件中设置 `enabled = false` 即可完全禁用插件。

### Q3: 淫乱度系统会自动评分吗？

**A**: 会。启用淫乱度系统后，对 master 用户的私聊消息，系统会自动调用 LLM 评分（0-10分），并根据评分更新高潮值。

### Q4: 月经期为什么淫乱度强制为 0？

**A**: 这是基于真实生理设计的。月经期由于生理原因，通常不适合性行为，所以淫乱度系统会自动关闭。

### Q5: 高潮值如何增加？

**A**: 
- **自动增加**：当你发送包含性相关内容的消息时，LLM 会评分，分数会转化为高潮值增长
- **自然衰减**：高潮值会随时间自然衰减（每秒 0.1）
- **加速衰减**：正戏阶段连续低评分会触发 2 倍衰减

### Q6: 余韵期和恢复期是什么？

**A**: 
- **余韵期**：高潮后的满足和放松阶段（默认 60 秒）
- **恢复期**：体力恢复阶段，感到温和疲倦但可正常交流（默认 240 秒）

这两个阶段形成完整的生理循环，让体验更真实。

### Q7: 如何触发性交提前终止？

**A**: 在正戏阶段（高潮值 60-100），如果连续 3 次 LLM 评分低于 3.0，系统会判定性交终止，并进入余韵期和恢复期。

### Q8: 配置修改后需要重启吗？

**A**: 
- 大部分配置会在下次对话时生效
- 如果修改了 `enabled` 等关键配置，建议重启 Bot
- 修改 `anchor_day` 后，可使用 `/重新生成周期` 立即生效

### Q9: 双周期模型是什么？

**A**: 插件会一次性生成两个连续的周期（约 62 天），避免频繁重新生成。两个周期的长度会略有不同（26-32 天范围内随机），更接近真实情况。

### Q10: 痛经等级有什么影响？

**A**: 痛经等级（0-6）会影响：
- 机器人的回复中会体现出不适感
- 等级越高，描述的痛苦程度越强
- 仅在月经期出现

---

## ⚠️ 注意事项

### 隐私保护

- ✅ 所有数据存储在本地 `data/plugin_data/mofox_period_plugin/`
- ✅ 命令只能在私聊中使用
- ✅ 建议不要在公共频道讨论周期相关话题

### 权限要求

- 淫乱度系统的 LLM 评分功能需要 **master 权限**
- 在 `config/bot_config.toml` 中配置 master 用户

### 性能影响

- 插件本身性能开销很小
- 如果启用淫乱度系统，每条私聊消息会额外调用一次 LLM（仅 master 用户）

### 模型要求

- 淫乱度系统的评分功能需要配置可用的 LLM 模型
- 如果没有配置模型，会自动使用关键词回退方案

---

## 🎯 最佳实践

### 1. 首次使用

```
/set_anchor 15         # 设置合适的锚点日期
/月经状态              # 查看初始状态
```

### 2. 日常使用

- **无需频繁查询**：插件会自动在后台工作，影响机器人的回复
- **定期检查**：每周查看一次状态即可
- **异常时重置**：如果发现状态不对，使用 `/重新生成周期`

### 3. 淫乱度系统使用

如果启用了淫乱度系统：
- **自然对话**：系统会自动评分和更新，无需手动干预
- **查看状态**：好奇时可以用 `/淫乱度状态` 查看
- **手动重置**：如果想重新开始，使用 `/lust_end`

---

## 📞 技术支持

如果遇到问题：

1. **查看日志**：`logs/` 目录下的日志文件
2. **检查配置**：确认配置文件格式正确
3. **重新生成**：使用 `/重新生成周期` 尝试修复
4. **反馈问题**：在项目 GitHub 提交 Issue

---

## 📝 更新日志

### 最新版本特性

- ✅ 双周期锚定模型
- ✅ 完整的淫乱度生理循环（余韵期 + 恢复期）
- ✅ 性交提前终止判定机制
- ✅ 单例模式优化（修复配置跳动问题）
- ✅ 痛经等级系统
- ✅ KFC 模式完整支持

---

## 🎉 开始使用

现在你已经了解了所有功能，可以开始使用了！

```
/月经状态    # 先查看当前状态
```

祝你使用愉快！如有任何疑问，随时查看本指南。✨
